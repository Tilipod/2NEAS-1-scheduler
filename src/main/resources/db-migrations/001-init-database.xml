<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">

    <changeSet id="20220401-1000" author="tilipod">

        <createTable tableName="task">

            <column type="bigint" name="id" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>

            <column type="uuid" name="process_id">
                <constraints nullable="false" unique="true"/>
            </column>

            <column type="varchar" name="json_client">
                <constraints nullable="false"/>
            </column>

            <column type="boolean" name="with_mentoring" defaultValue="false"/>

            <column type="varchar" name="status">
                <constraints nullable="false"/>
            </column>

            <column type="timestamptz" name="created_date_time">
                <constraints nullable="false"/>
            </column>

            <column type="timestamptz" name="last_updated_date_time">
                <constraints nullable="false"/>
            </column>

        </createTable>

        <createTable tableName="neuron_network">

            <column type="bigint" name="id" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>

            <column type="varchar" name="type">
                <constraints nullable="false"/>
            </column>

            <column type="blob" name="binary_network"/>

            <column type="bigint" name="task_id">
                <constraints nullable="false" unique="true" foreignKeyName="neuron_network_task_foreign_key"
                             references="task(id)" deleteCascade="true"/>
            </column>

            <column type="timestamptz" name="created_date_time">
                <constraints nullable="false"/>
            </column>

            <column type="timestamptz" name="last_updated_date_time">
                <constraints nullable="false"/>
            </column>

        </createTable>

        <createTable tableName="course">

            <column type="bigint" name="id" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>

            <column type="bigint" name="epoch_number" defaultValue="0"/>

            <column type="bigint" name="prototype_number" defaultValue="0"/>

            <column type="bigint" name="number_prototypes">
                <constraints nullable="false"/>
            </column>

            <column type="bigint" name="batch_size" defaultValue="10"/>

            <column type="bigint" name="neuron_network_id">
                <constraints nullable="false" unique="true" foreignKeyName="course_neuron_network_foreign_key"
                             references="neuron_network(id)" deleteCascade="true"/>
            </column>

            <column type="timestamptz" name="created_date_time">
                <constraints nullable="false"/>
            </column>

            <column type="timestamptz" name="last_updated_date_time">
                <constraints nullable="false"/>
            </column>

        </createTable>

        <createTable tableName="supervision">

            <column type="bigint" name="id" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>

            <column type="number" name="harmony" defaultValue="0.0"/>

            <column type="bigint" name="course_id">
                <constraints nullable="false" unique="true" foreignKeyName="supervision_course_foreign_key"
                             references="course(id)" deleteCascade="true"/>
            </column>

            <column type="timestamptz" name="created_date_time">
                <constraints nullable="false"/>
            </column>

            <column type="timestamptz" name="last_updated_date_time">
                <constraints nullable="false"/>
            </column>

        </createTable>

    </changeSet>



</databaseChangeLog>
